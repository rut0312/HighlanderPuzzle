# HighlanderPuzzle
The codes to help solving puzzle

### 概要

マップと使える線路数を入れると、可能なら構成例を、不可能ならImpossibleと返します。
経由点を全て通り始点から終点まで向かうようにセットされていますが、その他の報酬は無視します。

線路がランダムに選択されていった際に、その時点で使える線路数に対応した解答が存在するかを逐一確認できるのがメリットです。


### 免責

著者はプログラマではありません。  
完全に趣味で作った範囲なのでUI等は整っておらず、バグを含む可能性もあります。
（ある程度テストはしており、その範囲で正しく出力を出すことは確認してあります。）  
マップが複雑な場合、実行時間が長くなる可能性があります。
（4,5枚目のマップに対して最大O(100)ms程度）

マップの入力がやや面倒です。これなら自分で考えたほうが早かったとなる可能性も少しあります。

### 入力

```math
$H$ $W$
$X$ $Y$ $Z$
$A_{0,0}$ $A_{0,1}$ $\ldots$ $A_{0,W-1}$
$A_{1,0}$ $A_{1,1}$ $\ldots$ $A_{1,W-1}$
$\vdots$
$A_{H-1,0}$ $A_{H-1,1}$ $\ldots$ $A_{H-1,W-1}$
```


マップと使える線路の数を与えます。下の入出力例も参考にしてください。

#### 使える線路の数

- $X$: 直線線路
- $Y$: 緩やかなカーブ
- $Z$: 急カーブ

在庫ではなく、使える数です。  
マップに置かれているものを数えても良いですが、
初期在庫を記録しておいて、現在の在庫を差し引くというのが早いと思います。


#### マップ

座標系は左上をマス $(0,0)$ として $1$ つ右に進んだところをマス $(0,1)$、左下に進んだところをマス $(1,0)$ とした斜交座標系を用います。  
例として、$(0,0)$ と隣接しているマスは $(0,1),(1,1),(1,0),(0,-1),(-1,-1),(-1,0)$ になります。

$H,W$ はマップの行数と列数を表します。

- **必ず左右上下に一列何もない(線路が置けない、かつ 始点, 終点, 経由点のいずれでもない)列を設ける事**（境界判定をサボったため）
- $1\leq H\leq 20$, $1\leq W\leq 20$

$A_{i,j}$ はマス目の状態を表します。


- $0$: 線路を置けるマス
- $77$: 始点
- $88$: 終点
- $xy$: 経由点, そのマスの中心から見て右を $0$, 右下を $1$, 左下を $2$, 左を $3$, 左上を $4$, 右上を $5$ としたとき線路が伸びている方を十の位と一の位に並べる。例えば左下と右下を結ぶ急カーブの場合は $12$ となる。$21$ でも問題ない。
- $-1$: その他の何でもないマス

### 出力

"Impossible" が出力された時は不可能です。  
そうでない場合、$2$ 桁の数字が $H\times W$ 個並んだものが出力されます。
$H\times W$ 個の数字は入力と同様にマップのマスと一対一に対応しています。

$00$ は通らないマスです。
$01$ が終点のマスで、最大の数字が始点のマスになっています。  
$1,2,3\ldots$ と対応するマスを順に通るように線路を配置したものが正解になります。
経由点も番号に含まれています。(その場合そこに線路を置く必要はもちろんありません。)


### 入出力例

$5$ 枚目のマップを 直線 $4$ 枚、緩カーブ $13$ 枚、急カーブ $3$ 枚で解く場合 (緩カーブ $4$ 枚、急カーブ $6$ 枚残し)  
詳細はブルーアーカイブ非公式攻略wikiさんの記事 https://gamerch.com/bluearchive/918073 も参照  
ただし、出力例はwikiと対応していません。(条件を満たす置き方が複数あるため)

#### 入力

```
10 13
4 13 3
-1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1
-1 -1 -1 -1  0  0 -1 -1 -1 -1 -1 -1 -1
-1  0  0 30  0 -1  0 23 -1 -1 -1 -1 -1
-1 -1  0  0  0  0  0  0 -1 -1 -1 -1 -1
-1 -1 -1 -1  0 -1  0  0 -1 -1 -1 -1 -1
-1 -1 -1 -1  0  0  0  0  0 -1 -1 -1 -1
-1 -1 -1 77  0  0 13  0  0  0 -1 -1 -1
-1 -1 -1 -1 -1  0  0  0 -1  0 -1 -1 -1
-1 -1 -1 -1 -1 -1 -1 -1 -1 -1  0 88 -1
-1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1
```

#### 出力

```
00 00 00 00 00 00 00 00 00 00 00 00 00
00 00 00 00 00 00 00 00 00 00 00 00 00
00 00 14 13 12 00 09 08 00 00 00 00 00
00 00 00 15 16 11 10 07 00 00 00 00 00
00 00 00 00 17 00 00 06 00 00 00 00 00
00 00 00 00 00 18 19 00 05 00 00 00 00
00 00 00 25 24 23 22 20 00 04 00 00 00
00 00 00 00 00 00 00 21 00 03 00 00 00
00 00 00 00 00 00 00 00 00 00 02 01 00
00 00 00 00 00 00 00 00 00 00 00 00 00
```

### その他

最初にも触れましたが完全に私用目的で作ったので、ユーザーのことを考えていません。  
良い感じのもの（上位互換）ができるまでの繋ぎのつもりです。  
そんな人がいるかは置いておいて、他のツールへの借用・組み込みも自由です。(不具合が出ても責任は負えませんが)  
無断でも良いですが、一声かけてくれたら喜びます。
（私的にコピーして使う分には完全に無断で構いません。）

rut0312  
2025/04/24